<!DOCTYPE html>
<html lang="en">
<head>
    <title>Simple Voting App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <script>
        function vote(candidate) {
            fetch("/api/vote", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ candidate: candidate })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    updateResults(data.results);
                }
            });
        }

        function fetchResults() {
            fetch("/api/results")
                .then(response => response.json())
                .then(data => updateResults(data));
        }

        function updateResults(results) {
            let resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            let totalVotes = Object.values(results).reduce((a, b) => a + b, 0);

            for (let [candidate, votes] of Object.entries(results)) {
                let percent = totalVotes > 0 ? Math.round((votes / totalVotes) * 100) : 0;

                resultsDiv.innerHTML += `
                  <div class="mb-3">
                    <label class="form-label"><b>${candidate}</b> (${votes} votes)</label>
                    <div class="progress">
                      <div class="progress-bar bg-success" role="progressbar" 
                           style="width: ${percent}%" aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100">
                        ${percent}%
                      </div>
                    </div>
                  </div>
                `;
            }
        }

        setInterval(fetchResults, 5000); 
        window.onload = fetchResults;
    </script>
</head>
<body class="container mt-5">
    <h2 class="text-center">Simple Voting App</h2>

    <div class="text-center mt-4">
        {% for candidate, votes in candidates.items() %}
            <button class="btn btn-primary m-2" onclick="vote('{{ candidate }}')">Vote {{ candidate }}</button>
        {% endfor %}
    </div>

    <h4 class="mt-5">Results:</h4>
    <div id="results"></div>
</body>
</html>
